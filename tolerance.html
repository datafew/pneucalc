<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tolerans Bölgeleri & Geçme — Parça Bazlı Yüzey Hassasiyeti</title>
<style>
  :root{
    --bg:#0f1f3a; --panel:#1b2b4f; --card:#192645; --muted:#9fb2d9; --text:#e7eeff;
    --hole:#f87171; --shaft:#34d399; --border:1px solid rgba(255,255,255,.08);
    --fine:#60a5fa; --medium:#a78bfa; --coarse:#94a3b8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(135deg,#0b1a35,#11264a);color:var(--text);font:15px/1.35 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;padding:18px;}
  .container{max-width:1200px;margin:0 auto;}
  h1{margin:4px 0 6px 0;font-size:1.9rem;}
  .sub{color:var(--muted);font-size:13px;margin-bottom:10px;}

  .panel{background:var(--panel);border:var(--border);border-radius:12px;padding:14px;box-shadow:0 24px 60px rgba(0,0,0,.4);}
  .controls{display:grid;grid-template-columns:repeat(4,minmax(180px,1fr));gap:12px;align-items:end;}
  .ctrl{display:flex;flex-direction:column;gap:6px;}
  label{font-size:11px;color:var(--muted);letter-spacing:.6px;text-transform:uppercase;}
  input,select{background:#0e1a34;border:1px solid rgba(255,255,255,.14);color:var(--text);border-radius:8px;padding:10px;font-size:15px;}
  .section{margin-top:22px;}

  .viz-labels{display:flex;justify-content:space-between;align-items:center;margin:6px 2px;}
  .viz-label{font-size:12px;font-weight:700;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.2);}
  .viz-label.left{background:rgba(52,211,153,.18);color:#d8ffee;border-color:rgba(52,211,153,.35);}
  .viz-label.right{background:rgba(248,113,113,.18);color:#fff1f1;border-color:rgba(248,113,113,.35);}

  .viz{position:relative;background:var(--card);border:var(--border);border-radius:10px;padding:14px;min-height:200px;}
  .axis{position:absolute;left:50%;top:34px;bottom:34px;width:2px;background:rgba(255,255,255,.6);}
  .scale{display:flex;justify-content:space-between;color:var(--muted);font-size:12px;margin-top:6px;}
  .bar{position:absolute;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;letter-spacing:.5px;}
  .bar.hole{background:var(--hole);color:#fff;top:112px;}
  .bar.shaft{background:var(--shaft);color:#063522;top:66px;}

  /* Ribbons */
  .ribbon{display:flex;justify-content:center;gap:10px;margin:12px 0 8px 0;flex-wrap:wrap;}
  .chip{padding:8px 12px;border-radius:999px;border:var(--border);cursor:pointer;font-weight:700;
    background:rgba(255,255,255,.06);color:#cbd5e1;box-shadow:none;transition:all .15s ease;}
  .chip:hover{transform:translateY(-1px);}
  .chip.active{box-shadow:0 0 0 2px rgba(255,255,255,.25),0 8px 24px rgba(0,0,0,.45);color:#fff;}
  /* Fit colors */
  #fitRibbon .chip[data-fit="Interference"].active{background:rgba(239,68,68,.95);border-color:rgba(239,68,68,.85);}
  #fitRibbon .chip[data-fit="Transition"].active{background:rgba(245,158,11,.95);border-color:rgba(245,158,11,.85);color:#1a1200;}
  #fitRibbon .chip[data-fit="Clearance"].active{background:rgba(34,197,94,.95);border-color:rgba(34,197,94,.85);}
  /* Quality colors */
  .chip.q.Fine.active{background:var(--fine);border-color:#3b82f6;}
  .chip.q.Medium.active{background:var(--medium);border-color:#8b5cf6;}
  .chip.q.Coarse.active{background:var(--coarse);border-color:#64748b;}

  /* Per-part quality layout */
  .quality-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;max-width:820px;margin:0 auto;}
  .quality-group{display:flex;align-items:center;gap:10px;justify-content:center;}
  .quality-label{font-size:12px;color:#cfe0ff;opacity:.8;}

  .usage-cards{max-width:820px;margin:10px auto 0 auto;display:grid;grid-template-columns:1fr;gap:8px;}
  .usage-card{background:rgba(255,255,255,.06);padding:10px 12px;border-radius:10px;border:var(--border);text-align:center;color:#cfe0ff;}

  .single{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px;}
  .card{background:var(--card);border:var(--border);border-radius:10px;padding:12px;min-height:120px;display:flex;flex-direction:column;gap:6px;}
  .card h3{margin:0 0 6px 0;font-size:1.02rem;}
  .row{display:flex;gap:12px;flex-wrap:wrap;}
  .kv{flex:1;min-width:140px;background:rgba(255,255,255,.05);padding:8px;border-radius:8px;}
  .kv .k{color:#cfe0ff;font-size:12px;}
  .kv .v{font-weight:800;font-size:1.05rem;}

  .results{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:14px;}
  .result{background:var(--card);border:var(--border);border-radius:10px;padding:12px;min-height:170px;display:flex;flex-direction:column;gap:6px;}
  .note{font-size:12px;color:var(--muted);margin-top:10px;}
</style>
</head>
<body>
<div class="container">
  <h1>Tolerans Bölgeleri & Geçme</h1>
  <div class="sub">Delik ve mil tolerans kodlarını seç; birleşik grafikte bölgeleri gör. Üst/Alt sapmalar ve limit boylar otomatik hesaplanır.</div>

  <div class="panel">
    <div class="controls">
      <div class="ctrl">
        <label>Nominal çap D (mm)</label>
        <input id="D" type="number" min="1" step="1" value="50">
      </div>

      <div class="ctrl">
        <label>Delik tolerans bölgesi</label>
        <div style="display:flex;gap:8px;">
          <select id="holeLetter">
            <option>H</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option>
            <option>K</option><option>N</option><option>P</option><option>S</option><option>U</option>
          </select>
          <input id="holeGrade" type="number" min="5" max="12" step="1" value="8" style="width:90px;">
        </div>
      </div>

      <div class="ctrl">
        <label>Mil tolerans bölgesi</label>
        <div style="display:flex;gap:8px;">
          <select id="shaftLetter">
            <option>h</option><option>c</option><option>d</option><option>e</option><option>f</option><option>g</option>
            <option>k</option><option>m</option><option>n</option><option>p</option><option>s</option><option>u</option>
          </select>
          <input id="shaftGrade" type="number" min="5" max="12" step="1" value="7" style="width:90px;">
        </div>
      </div>

      <div class="ctrl">
        <label>Ön tanımlı kombinasyonlar</label>
        <select id="presetSelect">
          <optgroup label="Sıkı (Interference)">
            <option value="H7/p6">H7/p6 — Rulman</option>
            <option value="H7/s6">H7/s6 — Pres</option>
            <option value="H7/u6">H7/u6 — Termal</option>
          </optgroup>
          <optgroup label="Geçişli (Transition)">
            <option value="H7/k6" selected>H7/k6 — Konum</option>
            <option value="H7/n6">H7/n6 — Pim</option>
            <option value="K7/h6">K7/h6 — Konum</option>
          </optgroup>
          <optgroup label="Boşluklu (Clearance)">
            <option value="H8/f7">H8/f7 — Şaft-Yatak</option>
            <option value="H8/g6">H8/g6 — Döner</option>
            <option value="H11/c11">H11/c11 — Döküm</option>
          </optgroup>
          <optgroup label="Kaba (Loose)">
            <option value="C11/h11">C11/h11 — Gövde</option>
            <option value="H11/c11">H11/c11 — Montaj</option>
          </optgroup>
        </select>
      </div>
    </div>

    <div class="viz-labels">
      <div class="viz-label left">Mil bölgesi (Üst/Alt sapma)</div>
      <div class="viz-label right">Delik bölgesi (Üst/Alt sapma)</div>
    </div>

    <div class="section viz">
      <div class="axis"></div>
      <div id="shaftBar" class="bar shaft">h7</div>
      <div id="holeBar" class="bar hole">H8</div>
      <div class="scale"><div>Negatif</div><div>Pozitif</div></div>
    </div>

    <!-- Fit tipi: 3 çip -->
    <div id="fitRibbon" class="ribbon">
      <div class="chip" data-fit="Interference" data-preset="H7/p6">Interference (Sıkı)</div>
      <div class="chip" data-fit="Transition"  data-preset="H7/k6">Transition (Geçişli)</div>
      <div class="chip" data-fit="Clearance"   data-preset="H8/f7">Clearance (Boşluklu)</div>
    </div>

    <!-- Parça bazlı Yüzey hassasiyeti (Delik & Mil ayrı) -->
    <div class="quality-grid">
      <div class="quality-group" id="qualityHole">
        <div class="quality-label">Delik:</div>
        <div class="chip q Fine"   data-target="hole" data-grade="7">İnce</div>
        <div class="chip q Medium" data-target="hole" data-grade="9">Orta</div>
        <div class="chip q Coarse" data-target="hole" data-grade="11">Kaba</div>
      </div>
      <div class="quality-group" id="qualityShaft">
        <div class="quality-label">Mil:</div>
        <div class="chip q Fine"   data-target="shaft" data-grade="6">İnce</div>
        <div class="chip q Medium" data-target="shaft" data-grade="8">Orta</div>
        <div class="chip q Coarse" data-target="shaft" data-grade="11">Kaba</div>
      </div>
    </div>

    <div class="usage-cards">
      <div class="usage-card"><strong>Önerilen kullanım:</strong> <span id="usage">—</span></div>
      <div class="usage-card"><strong>Uygun imalat:</strong> <span id="process">—</span></div>
    </div>

    <div class="single">
      <div class="card">
        <h3>Geçme Tipi</h3>
        <div class="row">
          <div class="kv"><div class="k">Tip</div><div id="fitType" class="v">—</div></div>
          <div class="kv"><div class="k">C<sub>min</sub></div><div id="Cmin" class="v">—</div></div>
          <div class="kv"><div class="k">C<sub>max</sub></div><div id="Cmax" class="v">—</div></div>
        </div>
        <div id="fitComment" class="sub" style="margin-top:6px;">—</div>
      </div>
    </div>

    <div class="results">
      <div class="result">
        <h3>Delik tarafı (Üst/Alt sapma)</h3>
        <div class="row">
          <div class="kv"><div class="k">Üst sapma</div><div id="ES" class="v">—</div></div>
          <div class="kv"><div class="k">Alt sapma</div><div id="EI" class="v">—</div></div>
          <div class="kv"><div class="k">IT (µm)</div><div id="holeIT" class="v">—</div></div>
        </div>
        <div class="row">
          <div class="kv"><div class="k">D<sub>max</sub> (mm)</div><div id="Dmax" class="v">—</div></div>
          <div class="kv"><div class="k">D<sub>min</sub> (mm)</div><div id="Dmin" class="v">—</div></div>
        </div>
      </div>
      <div class="result">
        <h3>Mil tarafı (Üst/Alt sapma)</h3>
        <div class="row">
          <div class="kv"><div class="k">Üst sapma</div><div id="es" class="v">—</div></div>
          <div class="kv"><div class="k">Alt sapma</div><div id="ei" class="v">—</div></div>
          <div class="kv"><div class="k">IT (µm)</div><div id="shaftIT" class="v">—</div></div>
        </div>
        <div class="row">
          <div class="kv"><div class="k">d<sub>max</sub> (mm)</div><div id="dmax" class="v">—</div></div>
          <div class="kv"><div class="k">d<sub>min</sub> (mm)</div><div id="dmin" class="v">—</div></div>
        </div>
      </div>
    </div>

    <div class="note">Not: “Üst/Alt sapma” delikte ES/EI; milde es/ei karşılığıdır. C<sub>min</sub>/C<sub>max</sub> geçme aralığıdır.</div>
  </div>
</div>

<script>
function unit_i(D){ D=Math.max(1,parseFloat(D)||0); return 0.45*Math.cbrt(D)+0.001*D; }
function IT_from_grade(D,grade){ const i=unit_i(D); const k={5:7,6:10,7:16,8:25,9:40,10:64,11:100,12:160}; return Math.round((k[grade]||100)*i); }
function fd_shaft_es(letter,D){ switch(letter){
  case 'c': return -52*Math.pow(D,0.2);
  case 'd': return -16*Math.pow(D,0.44);
  case 'e': return -11*Math.pow(D,0.41);
  case 'f': return -5.5*Math.pow(D,0.41);
  case 'g': return -2.5*Math.pow(D,0.34);
  case 'h': return 0; default:return 0;}}
function fd_shaft_ei(letter,D){ const IT6=IT_from_grade(D,6), IT7=IT_from_grade(D,7), IT8=IT_from_grade(D,8);
  switch(letter){case 'k':return 0.6*Math.cbrt(D); case 'm':return (IT7-IT6); case 'n':return 5*Math.pow(D,0.34);
  case 'p':return IT7+2; case 's':return IT8+2; case 'u':return IT7+D; default:return 0;}}
function deviations_hole(letter,grade,D){ const IT=IT_from_grade(D,grade); let ES=0, EI=0;
  if(letter==='H'){EI=0; ES=IT;}
  else if(['C','D','E','F','G'].includes(letter)){ const map={C:'c',D:'d',E:'e',F:'f',G:'g'}; const es=fd_shaft_es(map[letter],D); EI=es; ES=EI+IT; }
  else if(['K','N','P','S','U'].includes(letter)){ const map={K:'k',N:'n',P:'p',S:'s',U:'u'}; const ei=fd_shaft_ei(map[letter],D); const ITp=IT_from_grade(D,grade-1)||IT; ES=(ei||0)+(IT-ITp); EI=ES-IT; }
  else{EI=0; ES=IT;} return {IT,ES,EI};}
function deviations_shaft(letter,grade,D){ const IT=IT_from_grade(D,grade); let es=0, ei=0;
  if(letter==='h'){es=0; ei=-IT;}
  else if(['c','d','e','f','g'].includes(letter)){ es=fd_shaft_es(letter,D); ei=es-IT;}
  else if(['k','m','n','p','s','u'].includes(letter)){ ei=fd_shaft_ei(letter,D); es=ei+IT;}
  else{es=0; ei=-IT;} return {IT,es,ei};}
function um_to_mm(u){return u/1000;} function fmt(x,d=3){return (Math.round((x||0)*Math.pow(10,d))/Math.pow(10,d)).toFixed(d);}

function classify(Cmin,Cmax){
  if(Cmax<0) return {name:'Interference',desc:'Her durumda sıkı geçme.', usage:'Rulman yuvası, pres geçme', process:'Taşlama/honlama, hassas raybalama'};
  if(Cmin>0) return {name:'Clearance',desc:'Boşluklu geçme.', usage:'Şaft-yatak, dönen eleman', process:'Raybalama, torna/freze, hassas delik açma'};
  return {name:'Transition',desc:'Hafif geçişli / kontrollü.', usage:'Dişli-mil, pimli montaj (kontrollü)', process:'Taşlama/finishaj, raybalama, hassas torna'};
}

function qualityLevelFromGrade(grade){
  if (grade <= 7) return 'Fine';
  if (grade >= 11) return 'Coarse';
  return 'Medium';
}

const D_el=document.getElementById('D');
const holeLetter=document.getElementById('holeLetter');
const holeGrade=document.getElementById('holeGrade');
const shaftLetter=document.getElementById('shaftLetter');
const shaftGrade=document.getElementById('shaftGrade');
const presetSelect=document.getElementById('presetSelect');
const shaftBar=document.getElementById('shaftBar');
const holeBar=document.getElementById('holeBar');
const fitRibbon=document.getElementById('fitRibbon');
const qHole=document.getElementById('qualityHole');
const qShaft=document.getElementById('qualityShaft');

const fitType=document.getElementById('fitType');
const Cmin_el=document.getElementById('Cmin');
const Cmax_el=document.getElementById('Cmax');
const fitComment=document.getElementById('fitComment');
const usageEl=document.getElementById('usage');
const processEl=document.getElementById('process');
const ES_el=document.getElementById('ES'), EI_el=document.getElementById('EI'), holeIT_el=document.getElementById('holeIT'), Dmax_el=document.getElementById('Dmax'), Dmin_el=document.getElementById('Dmin');
const es_el=document.getElementById('es'), ei_el=document.getElementById('ei'), shaftIT_el=document.getElementById('shaftIT'), dmax_el=document.getElementById('dmax'), dmin_el=document.getElementById('dmin');

function setActiveFit(name){
  const chips = fitRibbon.querySelectorAll('.chip');
  chips.forEach(ch => ch.classList.remove('active'));
  const t = Array.from(chips).find(ch => ch.dataset.fit === name);
  if (t) t.classList.add('active');
}

function setActiveQuality(groupEl, level){
  const chips = groupEl.querySelectorAll('.chip.q');
  chips.forEach(ch => ch.classList.remove('active'));
  const t = Array.from(chips).find(ch => ch.classList.contains(level));
  if (t) t.classList.add('active');
}

function applyPresetValue(val){
  const [hole, shaft] = val.split('/');
  holeLetter.value = hole.match(/[A-Z]+/)[0];
  holeGrade.value  = hole.match(/\d+/)[0];
  shaftLetter.value= shaft.match(/[a-z]+/)[0];
  shaftGrade.value = shaft.match(/\d+/)[0];
  updateAll();
}

function applyQualityChip(target, grade){
  if (target === 'hole') holeGrade.value = grade;
  else shaftGrade.value = grade;
  updateAll();
}

function updateAll(){
  const D=parseFloat(D_el.value)||0;
  const hL=holeLetter.value.toUpperCase(); const hG=parseInt(holeGrade.value)||7;
  const sL=shaftLetter.value.toLowerCase(); const sG=parseInt(shaftGrade.value)||6;

  const hole=deviations_hole(hL,hG,D);
  const shaft=deviations_shaft(sL,sG,D);

  // Limits & fit
  const Dmax=D+um_to_mm(hole.ES), Dmin=D+um_to_mm(hole.EI);
  const dmax=D+um_to_mm(shaft.es), dmin=D+um_to_mm(shaft.ei);
  const Cmin=Dmin-dmax, Cmax=Dmax-dmin;
  const fit=classify(Cmin,Cmax);

  // Texts
  fitType.textContent=fit.name;
  fitComment.textContent=fit.desc;
  Cmin_el.textContent=fmt(Cmin);
  Cmax_el.textContent=fmt(Cmax);
  usageEl.textContent = fit.usage;
  processEl.textContent = fit.process;

  // Technical values
  ES_el.textContent = (hole.ES>=0?'+':'') + Math.round(hole.ES);
  EI_el.textContent = (hole.EI>=0?'+':'') + Math.round(hole.EI);
  holeIT_el.textContent = Math.round(hole.IT);
  Dmax_el.textContent = fmt(Dmax,3);
  Dmin_el.textContent = fmt(Dmin,3);
  es_el.textContent = (shaft.es>=0?'+':'') + Math.round(shaft.es);
  ei_el.textContent = (shaft.ei>=0?'+':'') + Math.round(shaft.ei);
  shaftIT_el.textContent = Math.round(shaft.IT);
  dmax_el.textContent = fmt(dmax,3);
  dmin_el.textContent = fmt(dmin,3);

  // Bars with clamping
  function toPct(um){ return 50 + (um/300)*50; }
  function clampPct(p){ return Math.max(2, Math.min(98, p)); }
  const sLRaw = toPct(shaft.ei), sRRaw = toPct(shaft.es);
  const sLeft = clampPct(Math.min(sLRaw, sRRaw)), sRight = clampPct(Math.max(sLRaw, sRRaw));
  shaftBar.style.left = sLeft + '%'; shaftBar.style.width = Math.max(3, sRight - sLeft) + '%'; shaftBar.textContent = `${sL}${sG}`;
  const hLRaw = toPct(hole.EI), hRRaw = toPct(hole.ES);
  const hLeft = clampPct(Math.min(hLRaw, hRRaw)), hRight = clampPct(Math.max(hLRaw, hRRaw));
  holeBar.style.left = hLeft + '%'; holeBar.style.width = Math.max(3, hRight - hLeft) + '%'; holeBar.textContent = `${hL}${hG}`;

  // Fit chip
  setActiveFit(fit.name);
  // Quality chips (per part)
  setActiveQuality(qHole,  qualityLevelFromGrade(hG));
  setActiveQuality(qShaft, qualityLevelFromGrade(sG));
}

presetSelect.addEventListener('change', e=> applyPresetValue(e.target.value));
document.querySelectorAll('#fitRibbon .chip').forEach(ch=> ch.addEventListener('click', ()=> applyPresetValue(ch.dataset.preset)));
document.querySelectorAll('.quality-group .chip.q').forEach(ch=> ch.addEventListener('click', ()=> applyQualityChip(ch.dataset.target, ch.dataset.grade)));
[D_el,holeLetter,holeGrade,shaftLetter,shaftGrade].forEach(el=>{ el.addEventListener('input', updateAll); el.addEventListener('change', updateAll); });

(function init(){
  const opt = presetSelect.selectedOptions[0];
  if(opt) applyPresetValue(opt.value); else updateAll();
})();
</script>
</body>
</html>
