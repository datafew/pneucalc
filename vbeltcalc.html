<!DOCTYPE html>
<html lang="tr"><head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kayış & Kasnak — Temiz Sürüm (final)</title>
<style>
  :root{
    --bg:#0b1020; --text:#e6eefc; --muted:#9bb0cc; --border:#26345e;
    --shadow: 0 10px 28px rgba(0,0,0,.35); --radius:16px;
    --ok:#2dd4bf; --warn:#f59e0b; --bad:#ef4444;
    --blue1:#16264c; --blue2:#0f1938; --green1:#0f2f24; --green2:#0b241c;
    --purple1:#331a3b; --purple2:#26132d; --amber1:#3a2a12; --amber2:#241808;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:
      radial-gradient(1000px 600px at 10% -10%,#142043,transparent 60%),
      radial-gradient(1000px 600px at 110% -10%,#0f1a33,transparent 60%),
      var(--bg);
    color:var(--text);
    font: 15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    display:flex; flex-direction:column;
  }
  /* duplicate-guard */
  .page ~ .page{display:none!important}
  main.container ~ main.container{display:none!important}
  header ~ header{display:none!important}

  .page{max-width: 980px; margin:0 auto; padding:0 clamp(14px,3.5vw,28px); width:100%; flex:1}
  header{padding:18px 0 6px}
  h1{margin:0 0 8px 0; font-size:clamp(20px,3.2vw,28px)}
  .lead{color:var(--muted); margin:0 0 6px 0}

  .container{padding:12px 0 28px; display:flex; flex-direction:column; gap:12px}
  .card{border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; background:#121a35}
  .card .hd{display:flex; align-items:center; gap:10px; padding:12px 14px; font-weight:600; font-size:16px; border-bottom:1px solid var(--border); background:linear-gradient(180deg,rgba(255,255,255,.05),transparent)}
  .card .content{padding:12px 14px}
  .theme-blue{background:linear-gradient(180deg,var(--blue1),var(--blue2))}
  .theme-green{background:linear-gradient(180deg,var(--green1),var(--green2))}
  .theme-purple{background:linear-gradient(180deg,var(--purple1),var(--purple2))}
  .theme-amber{background:linear-gradient(180deg,var(--amber1),var(--amber2))}

  .grid{display:grid; gap:10px; grid-template-columns: repeat(12,1fr); align-items:end}
  .col-6{grid-column: span 6}.col-4{grid-column: span 4}.col-3{grid-column: span 3}.col-12{grid-column: 1 / -1}
  @media (max-width:740px){ .col-6,.col-4,.col-3,.col-12{grid-column: 1 / -1} }
  label{display:block; color:var(--muted); font-size:12.5px; margin:0 0 6px}
  select,input{width:100%; padding:9px 11px; border-radius:12px; color:var(--text); border:1px solid var(--border); background:#0e152c; outline:none}
  input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }

  .muted{color:var(--muted)} .value{font-weight:600}
  .kv{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:7px 0; border-bottom:1px dashed var(--border)}
  .kv:last-child{border-bottom:0}
  .big{font-size:clamp(18px,4vw,26px); font-weight:800; color:var(--ok)}

  .note{display:flex; gap:8px; align-items:flex-start; padding:9px 10px; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,.04); font-size:14px; color:var(--muted)}
  .warn{color:#f59e0b} .bad{color:#ef4444}
  .tbl{width:100%; border-collapse:collapse}
  .tbl th,.tbl td{padding:8px 6px; border-bottom:1px solid var(--border); text-align:left; font-size:13.5px}
  .tbl th{color:var(--muted); font-weight:600}
  .reco-row td{background:rgba(61,199,255,.08)!important; box-shadow: inset 0 0 0 1px rgba(61,199,255,.35)}

  .footer{margin:18px auto 28px; max-width:980px; text-align:center; color:#cfe8ff; opacity:.95; font-weight:700; letter-spacing:.3px}
  .footer .brand{display:inline-block; background:linear-gradient(90deg,#7dd3fc,#22d3ee,#a78bfa,#34d399,#f59e0b,#7dd3fc); -webkit-background-clip:text; background-clip:text; color:transparent; animation:hues 8s linear infinite}
  @keyframes hues{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}
</style>
</head>
<body>
  <script>
  // self-heal against duplicate DOM
  (function(){
    const once=()=>{const one=s=>{const n=document.querySelectorAll(s); for(let i=1;i<n.length;i++) n[i].remove();}; one('.page'); one('header'); one('main.container');};
    if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', once, {once:true}); else once();
    new MutationObserver(()=>once()).observe(document.body,{childList:true});
  })();
  </script>

  <div class="page">
    <header>
      <h1>Kayış ve Kasnak Hesaplayıcı</h1>
      <p class="lead">Dar V‑kayışlı (SPZ/SPA/SPB/SPC) kasnak tahriklerinde ölçü seçimi için hızlı yardımcı. ISO 4184 kapsamında <strong>datum/hatve uzunluğu</strong> referansı esas alınır. Alanları değiştirin; sonuçlar anında güncellenir.</p>
    </header>

    <main id="app" class="container">
      <!-- GİRDİLER -->
      <section class="card theme-green">
        <div class="hd">Girdiler</div>
        <div class="content">
          <div class="grid">
            <div class="col-4">
              <label for="profile">Kayış profili (ISO 4184)</label>
              <select id="profile">
                <option value="SPZ">SPZ (10)</option>
                <option value="SPA">SPA (13)</option>
                <option value="SPB" selected>SPB (17)</option>
                <option value="SPC">SPC (22)</option>
              </select>
            </div>
            <div class="col-4">
              <label for="d1">Küçük kasnak hatve çapı d₁ (mm)</label>
              <select id="d1"></select>
            </div>
            <div class="col-4">
              <label for="d2">Büyük kasnak hatve çapı d₂ (mm)</label>
              <select id="d2"></select>
            </div>
            <div class="col-4">
              <label for="A">Eksen mesafesi A (mm)</label>
              <input id="A" type="number" value="300" min="1" step="1">
            </div>
            <div class="col-4">
              <label for="n1">Giriş devri n₁ (d/dak)</label>
              <input id="n1" type="number" value="3000" min="1" step="1">
            </div>
          </div>
          <div class="note" style="margin-top:8px">İpucu: Profil → kasnak çapları → A → n₁ sırasıyla girin. Alanlar değiştikçe hesap otomatik yapılır.</div>
        </div>
      </section>

      <!-- UYARILAR / NOTLAR (sonuçlardan önce) -->
      <section class="card theme-amber" id="warnCard" style="display:none">
        <div class="hd">Uyarılar / Notlar</div>
        <div class="content"><div id="warnArea"></div></div>
      </section>

      <!-- SONUÇLAR -->
      <section class="card theme-blue" aria-live="polite">
        <div class="hd">Sonuçlar</div>
        <div class="content">
          <div class="kv"><span class="muted">Hesaplanan L<sub>w</sub> / L<sub>d</sub></span><span class="big" id="LpShow">—</span></div>
          <div class="kv"><span class="muted">Önerilen standart L<sub>w</sub>/L<sub>d</sub></span><span class="value" id="stdLp">—</span></div>
          <div class="kv"><span class="muted">İç uzunluk L<sub>i</sub></span><span class="value" id="Li">—</span></div>
          <div class="kv"><span class="muted">Dış/çevre uzunluğu L<sub>a</sub></span><span class="value" id="La">—</span></div>
          <div class="kv"><span class="muted">Datum/hatve uzunluğu L<sub>d</sub></span><span class="value" id="Ld">—</span></div>
          <div class="kv"><span class="muted">Kesit b×h</span><span class="value" id="sect">—</span></div>
          <div class="kv"><span class="muted">Datum genişliği w<sub>d</sub></span><span class="value" id="wdVal">—</span></div>
          <div class="kv"><span class="muted">Sarma açısı α₁</span><span class="value" id="wrapInfo">—</span></div>
          <div class="kv"><span class="muted">Oran i = d₂/d₁</span><span class="value" id="ratioInfo">—</span></div>
          <div class="kv"><span class="muted">Önerilen A(min)</span><span class="value" id="minAinfo">—</span></div>
          <div class="kv"><span class="muted">Çıkış devri n₂</span><span class="value" id="n2">—</span></div>
        </div>
      </section>

      <!-- ALTERNATİFLER -->
      <section class="card theme-amber">
        <div class="hd">Standart Kayış Alternatifleri</div>
        <div class="content">
          <table class="tbl" id="candTable">
            <thead>
              <tr><th>Profil</th><th>L<sub>d</sub> (mm)</th><th>Δ (mm)</th><th>A′ (mm)</th><th>L<sub>i</sub> (mm)</th><th>L<sub>a</sub> (mm)</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="note" style="margin-top:8px">Not: L<sub>i</sub>/L<sub>a</sub> dar‑V için tipik ofsetlerle yaklaşık verilmiştir; üretici kataloğu ile teyit ediniz.</div>
        </div>
      </section>

      <!-- FORMÜLLER + KISALTMA SÖZLÜĞÜ -->
      <section class="card theme-green">
        <div class="hd">Formüller ve Kısaltma Sözlüğü</div>
        <div class="content">
          <ul style="margin:0 0 8px 18px; padding:0; color:var(--muted)">
            <li>Hatve uzunluğu: <code>L = 2A + (π/2)(d₁+d₂) + (Δd)² / (4A)</code>, <code>Δd = |d₂ − d₁|</code>.</li>
            <li>Sarma açısı (küçük kasnak): <code>α₁ = 180° − 57.2958°·(Δd/A)</code>.</li>
            <li>Öneri: <code>A(min) ≈ 0.5·(d_L−d_S) + 1.5·d_L</code>, <code>d_L = max(d₁,d₂)</code>, <code>d_S = min(d₁,d₂)</code>.</li>
            <li>Standart L verildiğinde yeni eksen: <code>A′ = (X + √(X² − 2Δd²)) / 4</code>, <code>X = L − (π/2)(d₁+d₂)</code>.</li>
          </ul>
          <div class="note"><b>Sözlük:</b> Lp: hatve; Ld: datum/hatve; Lw: etkin; Li: iç; La: dış/çevre; i: oran (d₂/d₁).</div>
        </div>
      </section>
    </main>
    <footer class="footer">Mechanical Toolbox by <span class="brand">sipahi</span> ⚙</footer>
  </div>

<script>
  // Veri tabloları
  const PULLEY_PD = {
    SPZ:[63,67,71,75,80,85,90,95,100,106,112,118,125,132,140,150,160,170,180,190,200,212,224,236,250,265,280],
    SPA:[80,85,90,95,100,106,112,118,125,132,140,150,160,170,180,190,200,212,224,236,250,265,280,300,315,335,355,375,400],
    SPB:[125,132,140,150,160,170,180,190,200,212,224,236,250,265,280,300,315,335,355,375,400,425,450,475,500],
    SPC:[200,212,224,236,250,265,280,300,315,335,355,375,400,425,450,475,500,530,560,600]
  };
  const BELT_SERIES = {
    SPZ:(()=>{const L=[587,600,612,630,650,670,687,700,710,730,750,762,775,800,812,825,837,850,875,900,912,937,950,962,975,1000]; for(let x=1025;x<=2000;x+=25)L.push(x); for(let x=2050;x<=3550;x+=50)L.push(x); return L;})(),
    SPA:(()=>{const L=[750,762,775,800,812,825,837,850,875,900,912,937,950,962,975,1000,1016,1030,1050]; for(let x=1075;x<=2500;x+=25)L.push(x); for(let x=2550;x<=5000;x+=50)L.push(x); return L;})(),
    SPB:(()=>{const L=[1250,1270,1287,1300,1320,1340,1350,1370,1400,1420,1450]; for(let x=1475;x<=3200;x+=25)L.push(x); for(let x=3250;x<=6300;x+=50)L.push(x); return L;})(),
    SPC:(()=>{const L=[2000,2030,2060,2120,2240]; for(let x=2300;x<=4000;x+=25)L.push(x); for(let x=4050;x<=10000;x+=50)L.push(x); return L;})()
  };
  // Optibelt SK / Red Power 3: Li = Ld − [38,45,60,83];  La = Li + [13,18,22,30]
  const OFFSETS = {
    SPZ:{ Li_from_Lp: Lp=>Lp-38, La_from_Lp: Lp=>(Lp-38)+13 },
    SPA:{ Li_from_Lp: Lp=>Lp-45, La_from_Lp: Lp=>(Lp-45)+18 },
    SPB:{ Li_from_Lp: Lp=>Lp-60, La_from_Lp: Lp=>(Lp-60)+22 },
    SPC:{ Li_from_Lp: Lp=>Lp-83, La_from_Lp: Lp=>(Lp-83)+30 },
  };
  const PROFILE = {
    SPZ:{b:9.7,h:8, wd:8.5, dmin:63},
    SPA:{b:12.7,h:10,wd:11,  dmin:90},
    SPB:{b:16.3,h:13,wd:14,  dmin:140},
    SPC:{b:22,  h:18,wd:19,  dmin:224},
  };

  const $=s=>document.querySelector(s);
  const fmt=n=>Number.isFinite(n)? Math.round(n)+" mm":"—";
  const delta=v=>v>0?'+':(v<0?'−':'±');

  function axisFromLength(L,d1,d2){
    const dd=Math.abs(d2-d1), X=L-(Math.PI/2)*(d1+d2), disc=X*X-2*(dd*dd);
    if(disc<0) return NaN; return (X+Math.sqrt(disc))/4;
  }

  const profileEl=$('#profile'), d1El=$('#d1'), d2El=$('#d2'), AEl=$('#A'), n1El=$('#n1');
  const LpShow=$('#LpShow'), stdLp=$('#stdLp'), LiEl=$('#Li'), LaEl=$('#La'), LdEl=$('#Ld'), n2El=$('#n2');
  const sectEl=$('#sect'), wdEl=$('#wdVal'), wrapInfo=$('#wrapInfo'), ratioInfo=$('#ratioInfo'), minAinfo=$('#minAinfo');
  const warnCard=$('#warnCard'), warnArea=$('#warnArea');

  function populatePulleys(){
    const pr=profileEl.value, list=PULLEY_PD[pr]||[];
    d1El.innerHTML=list.map(v=>`<option value="${v}">${v}</option>`).join('');
    d2El.innerHTML=list.map(v=>`<option value="${v}">${v}</option>`).join('');
    if(list.length){const m=Math.floor(list.length/2); d1El.value=list[Math.max(0,m-2)]; d2El.value=list[Math.min(list.length-1,m+2)];}
    compute();
  }
  function nearestIndex(x,arr){ if(!arr||!arr.length) return -1; let k=0,md=Math.abs(arr[0]-x); for(let i=1;i<arr.length;i++){const d=Math.abs(arr[i]-x); if(d<md){md=d;k=i;}} return k; }

  function addWarn(text,level='warn'){
    const icon=level==='bad'?'⛔':'⚠'; const cls=level==='bad'?'bad':'warn';
    const el=document.createElement('div'); el.className='note'; el.innerHTML=`<span class="${cls}">${icon}</span><div>${text}</div>`; warnArea.appendChild(el);
  }

  function compute(){
    warnArea.innerHTML=''; warnCard.style.display='none';
    const pr=profileEl.value; const d1=parseFloat(d1El.value); const d2=parseFloat(d2El.value);
    const A=parseFloat(AEl.value); const n1=parseFloat(n1El.value);

    // Profil bilgilerinin sonuçlarda görünmesi
    const p=PROFILE[pr]; if(p){ sectEl.textContent=`${p.b}×${p.h} mm`; wdEl.textContent=`${p.wd} mm`; addWarn(`Profil ${pr} için min küçük kasnak ≈ ${p.dmin} mm`, 'warn'); }

    const errs=[]; if(!pr||!BELT_SERIES[pr]) errs.push('Lütfen geçerli bir kayış profili seçin.');
    if(!Number.isFinite(d1)) errs.push('Küçük kasnak d₁ seçilmedi.');
    if(!Number.isFinite(d2)) errs.push('Büyük kasnak d₂ seçilmedi.');
    if(!Number.isFinite(A) || A<=0) errs.push('Eksen mesafesi A > 0 olmalıdır.');
    if(errs.length){ warnArea.innerHTML=errs.map(t=>`<div class="note"><span class="bad">⛔</span><div>${t}</div></div>`).join(''); warnCard.style.display='block';
      LpShow.textContent=stdLp.textContent=LiEl.textContent=LaEl.textContent=LdEl.textContent='—'; n2El.textContent='—'; wrapInfo.textContent=ratioInfo.textContent=minAinfo.textContent='—'; $('#candTable tbody').innerHTML=''; return; }

    const dd=Math.abs(d2-d1), dS=Math.min(d1,d2), dL=Math.max(d1,d2);
    const alpha1=180-57.2958*(dd/A); wrapInfo.textContent=`${alpha1.toFixed(1)}°`;
    if(p && dS<p.dmin) addWarn(`Küçük kasnak d_small=${Math.round(dS)} mm < d_min≈${p.dmin} mm (profil ${pr}).`, 'bad');
    if(alpha1<120) addWarn(`Sarma açısı düşük: α₁=${alpha1.toFixed(1)}°. En az 120° önerilir.`, 'warn');

    const Arec=0.5*(dL-dS)+1.5*dL; minAinfo.textContent=`${Math.round(Arec)} mm`; if(A<Arec) addWarn(`Eksen mesafesi düşük olabilir: A=${Math.round(A)} mm. Öneri ≥ ${Math.round(Arec)} mm.`, 'warn');

    const i=d2/d1; ratioInfo.textContent=`${i.toFixed(2)}`; if(Number.isFinite(n1)) n2El.textContent=Math.round(n1*(d1/d2))+' d/dak';

    const Lp=2*A + (Math.PI/2)*(d1+d2) + (dd*dd)/(4*A); LpShow.textContent=fmt(Lp); LdEl.textContent=fmt(Lp);

    const series=BELT_SERIES[pr]; const idx=nearestIndex(Lp,series); const nearest=series?series[idx]:null; if(nearest!=null){ stdLp.innerHTML=`<b>${nearest} mm</b> <span class="muted">(${delta(nearest-Lp)}${Math.abs(Math.round(nearest-Lp))} mm)</span>`; }

    const li=OFFSETS[pr].Li_from_Lp(Lp), la=OFFSETS[pr].La_from_Lp(Lp); LiEl.textContent=fmt(li); LaEl.textContent=fmt(la);

    // Alternatifler: önerilen satırı 3. sıraya sabitle, etiket kullanma
    const tbody=$('#candTable tbody'); tbody.innerHTML=''; if(series&&series.length){
      let picks=[]; for(let j=idx-2;j<=idx+2;j++) if(j>=0&&j<series.length) picks.push(series[j]);
      picks=[...new Set(picks)].sort((a,b)=>a-b); const pos=picks.indexOf(series[idx]); if(pos>-1 && pos!==2){ picks.splice(pos,1); picks.splice(2,0,series[idx]); }
      picks.slice(0,5).forEach(L=>{ const Li_c=OFFSETS[pr].Li_from_Lp(L), La_c=OFFSETS[pr].La_from_Lp(L); const d=Math.round(L-Lp); const Anew=axisFromLength(L,d1,d2); const cls=(L===series[idx])?' class="reco-row"':''; const row=`<tr${cls}><td>${pr}</td><td>${L}</td><td>${delta(d)}${Math.abs(d)}</td><td>${Number.isFinite(Anew)?Math.round(Anew):'—'}</td><td>${Math.round(Li_c)}</td><td>${Math.round(La_c)}</td></tr>`; tbody.insertAdjacentHTML('beforeend',row); });
    }

    warnCard.style.display = warnArea.childElementCount ? 'block' : 'none';
  }

  $('#profile').addEventListener('change', populatePulleys);
  $('#d1').addEventListener('change', compute);
  $('#d2').addEventListener('change', compute);
  $('#A').addEventListener('input', compute);
  $('#n1').addEventListener('input', compute);

  populatePulleys();
  setTimeout(compute,0);
</script>

</body></html>
