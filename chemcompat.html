<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sızdırmazlık Elastomerleri Kimyasal Dayanım Tablosu</title>
    <style>
        :root {
            /* Softer palette + thin gridlines (inspired by "Chemical Compatibility Checker" export) */
            --success-rgb: 52, 199, 89;   /* green */
            --primary-rgb: 10, 132, 255;  /* blue */
            --warning-rgb: 255, 204, 0;   /* yellow */
            --danger-rgb: 255, 59, 48;    /* red */
            --na-rgb: 148, 163, 184;      /* muted slate */

            --success: rgb(var(--success-rgb));
            --primary: rgb(var(--primary-rgb));
            --warning: rgb(var(--warning-rgb));
            --danger: rgb(var(--danger-rgb));
            --na: rgb(var(--na-rgb));

            /* Page surfaces */
            --background: #ffffff;
            --text: #111827;
            --border: #e5e7eb; /* subtle grid / outline */
            --card: #f8fafc;

            /* Zebra rows */
            --row-odd: #ffffff;
            --row-even: #f8fafc;

            /* Sticky offsets (JS updates --headH; --noW optional) */
            --headH: 0px;
            --noW: 44px;
            --chemW: 260px;
            --stateW: 20px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background: #0b0b0f;
                --text: #e6e6e6;
                --border: #2a2f3a;
                --card: #151821;

                --row-odd: #151821;
                --row-even: #10131a;

                /* slightly brighter accents on dark bg */
                --success-rgb: 45, 205, 115;
                --primary-rgb: 63, 160, 255;
                --warning-rgb: 255, 201, 74;
                --danger-rgb: 255, 107, 107;
                --na-rgb: 154, 160, 166;
            }
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { scroll-behavior: smooth; }

        body {
            font-family: Inter, system-ui, -apple-system, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.5;
        }

        .container {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 8px;
        }

        h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            margin: 0 0 12px 0;
            color: #475569;
            line-height: 1.45;
        }

        @media (prefers-color-scheme: dark) {
            .subtitle {
                color: #9aa0a6;
            }
        }

        .table-toolbar {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(6px);
            border-bottom: 1px solid var(--border);
        }

        @media (prefers-color-scheme: dark) {
            .table-toolbar {
                background: rgba(11, 11, 15, 0.92);
            }
        }

        .table-toolbar .toolbar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            flex-wrap: nowrap;
            overflow-x: auto;
        }

        .table-toolbar .toolbar-row::-webkit-scrollbar {
            height: 6px;
        }

        .legend-inline {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: nowrap;
            flex: 0 0 auto;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            color: #475569;
            font-size: 12px;
        }

        @media (prefers-color-scheme: dark) {
            .legend-item {
                color: #9aa0a6;
            }
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .dot.g { background: var(--success); }
        .dot.f { background: var(--primary); }
        .dot.p { background: var(--warning); }
        .dot.b { background: var(--danger); }
        .dot.n { background: transparent; outline: 1px solid var(--na); }

        input[type="search"], select {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--background);
            color: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            input[type="search"], select {
                background: var(--card);
            }
        }

        .table-toolbar input[type="search"] {
            min-width: 170px;
            flex: 1 1 220px;
        }

        .table-toolbar select {
            min-width: 108px;
            flex: 0 0 auto;
        }

        .table-toolbar select#material {
            width: 108px;
        }

        .table-toolbar select#rating {
            min-width: 112px;
            width: 112px;
        }

        #counter {
            margin-left: auto;
            white-space: nowrap;
            font-weight: 600;
            color: #475569;
            font-size: 12px;
        }

        @media (prefers-color-scheme: dark) {
            #counter {
                color: #9aa0a6;
            }
        }

        .table-wrap {
            padding: 10px 0;
        }

        .table-container {
            overflow: visible;
            border: 1px solid var(--border);
            background: var(--background);
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid var(--border);
            table-layout: fixed;
            font-size: 12px;
            font-weight: 400;
        }

        th, td {
            text-align: center;
            vertical-align: middle;
            /* Draw only right/bottom lines to avoid "double-thick" gridlines */
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        thead th:last-child,
        tbody td:last-child {
            border-right: none;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* Sticky header styles */
        thead th {
            position: -webkit-sticky;
            position: sticky;
            top: var(--headH);
            background: #fafafa;
            background-clip: padding-box;
            font-weight: 600;
            padding: 4px;
            font-size: 12px;
            line-height: 1.5;
            white-space: nowrap;
            z-index: 60;
        }

        @media (prefers-color-scheme: dark) {
            thead th {
                background: #0f1421;
                color: #cbd5e1;
            }
        }

        /* Remove sticky from first row */
        tbody tr:first-child td {
            border-top: none;
        }

        /* Keep base rows transparent; stripe sticky columns only (match export) */

        td {
            /* Flexible table cells: avoid fixed small height which causes layout shifts
               (was causing chemical name to overflow into the sticky No column). */
            padding: 4px;
            margin: 0;
            box-sizing: border-box;
            vertical-align: middle;
            white-space: nowrap; /* keep single-line cells to avoid row height jumps */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Sticky columns (match export sizing) */
        .no-col, .no-cell { width: var(--noW); min-width: var(--noW); max-width: var(--noW); }

        /* Make No column sticky */
        th.no-col {
            position: -webkit-sticky;
            position: sticky;
            left: 0;
            z-index: 72;
            padding: 4px 4px;
            text-align: center;
            min-width: var(--noW);
        }
        
        /* Sticky column styles */
        td.no-cell {
            position: -webkit-sticky;
            position: sticky;
            left: 0;
            background: #fbfbfd;
            text-align: center;
            padding: 4px 4px;
            z-index: 40;
        }

        /* Name cell styles */
        th.name-cell {
            position: -webkit-sticky;
            position: sticky;
            left: var(--noW);
            z-index: 71;
            min-width: var(--chemW);
            text-align: left;
        }

        td.name-cell {
            position: -webkit-sticky;
            position: sticky;
            left: var(--noW);
            z-index: 39;
            background: #fbfbfd;
            min-width: var(--chemW);
            padding: 4px 6px !important;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        tbody tr:nth-child(even) td.no-cell,
        tbody tr:nth-child(even) td.name-cell {
            background: #f7f9fc;
        }

        @media (prefers-color-scheme: dark) {
            td.no-cell,
            th.no-col {
                background: #0f1320;
                color: #e6e9f0;
            }

            td.name-cell {
                background: #0f1320;
                color: #e7eaf0;
            }

            tbody tr:nth-child(even) td.no-cell,
            tbody tr:nth-child(even) td.name-cell {
                background: #0d111b;
            }
        }

        /* rating classes are applied to the TD itself so the cell is colored */
        .rating {
            padding: 0;
            position: relative;
        }
        /* Rating fills (match "Chemical Compatibility Checker" export) */
        td.rating-5 { background-color: rgba(var(--success-rgb), 0.55); }
        td.rating-4 { background-color: rgba(var(--primary-rgb), 0.50); }
        td.rating-3 { background-color: rgba(var(--warning-rgb), 0.55); }
        td.rating-2 { background-color: rgba(var(--danger-rgb), 0.55); }
        td.rating-1 { background-color: transparent; }

        @supports (background: color-mix(in oklab, white 50%, black)) {
            @media (prefers-color-scheme: dark) {
                td.rating-5 { background-color: color-mix(in oklab, var(--success) 60%, #000); }
                td.rating-4 { background-color: color-mix(in oklab, var(--primary) 52%, #000); }
                td.rating-3 { background-color: color-mix(in oklab, var(--warning) 58%, #000); }
                td.rating-2 { background-color: color-mix(in oklab, var(--danger) 58%, #000); }
                td.rating-1 { background-color: transparent; }
            }
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #64748b;
        }

        /* Mobile-only responsive styles (avoid affecting desktop window resizing) */
        @media (max-width: 640px) {
            :root { --noW: 40px; --chemW: 200px; --stateW: 20px; }
            h1 {
                font-size: 1.5rem;
                margin-bottom: 0.75rem;
            }

            /* Mobile: show filters in a compact, fully visible layout */
            .table-toolbar .toolbar-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                overflow-x: visible;
                padding: 10px 0 12px;
            }

            .table-toolbar input[type="search"] {
                width: 100%;
                min-width: 0;
                flex: none;
            }

            .table-toolbar input#search { grid-column: 1; grid-row: 1; }
            .table-toolbar select#material { grid-column: 1; grid-row: 2; }
            .table-toolbar select#rating { grid-column: 2; grid-row: 2; }

            .table-toolbar select {
                width: 100%;
                min-width: 0;
            }

            .legend-inline {
                grid-column: 1 / -1;
                grid-row: 3;
                width: 100%;
                flex-wrap: wrap;
                gap: 8px;
            }

            #counter {
                grid-column: 2;
                grid-row: 1;
                justify-self: end;
                align-self: center;
                margin-left: 0;
            }

            .table-toolbar input[type="search"],
            .table-toolbar select {
                font-size: 13px;
                padding: 6px 10px;
            }

            /* Table adjustments for mobile */
            .table-container {
                border-radius: 0.375rem;
                margin: 0;
                overflow-x: auto;
                overflow-y: visible;
                -webkit-overflow-scrolling: touch;
                overscroll-behavior-x: contain;
            }

            th.name-cell,
            td.name-cell {
                min-width: 200px;
            }

            th.elastomer, td.elastomer { padding: 2px; }

            thead th {
                font-size: 11px;
                padding: 3px;
                line-height: 1.25;
            }

            /* Mobile: dedicated sticky header (with safe fallback) */
            .mobile-sticky-head {
                display: none;
                position: sticky;
                top: var(--headH);
                z-index: 45;
                margin: 0;
                background: var(--background);
                border-bottom: 1px solid var(--border);
            }

            .mobile-head-ready .mobile-sticky-head { display: block; }
            .mobile-head-ready #data-table thead { display: none; }

            .mobile-sticky-head .head-scroller {
                overflow-x: auto;
                overflow-y: hidden;
                -webkit-overflow-scrolling: touch;
                overscroll-behavior-x: contain;
            }

            .mobile-sticky-head .head-scroller::-webkit-scrollbar {
                height: 0;
            }

            .mobile-sticky-head table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0;
                border-left: none;
                border-right: none;
                border-top: 1px solid var(--border);
                border-bottom: none;
                table-layout: fixed;
                background: var(--background);
            }

            .mobile-sticky-head th {
                background: #fafafa;
                font-size: 11px;
                padding: 3px;
                line-height: 1.25;
            }

            @media (prefers-color-scheme: dark) {
                .mobile-sticky-head th {
                    background: #0f1421;
                    color: #cbd5e1;
                }
            }

            .mobile-sticky-head th.elastomer {
                writing-mode: vertical-rl;
                text-orientation: mixed;
                font-size: 10px;
                line-height: 1;
                padding: 6px 0;
                height: 64px;
            }
        }

        @media (max-width: 480px) {
            :root { --chemW: 180px; --stateW: 16px; }
        }

        /* iPhone 11 / ~375px: reduce chemical column to avoid horizontal scroll */
        @media (max-width: 414px) {
            :root { --chemW: 150px; }
            th.name-cell,
            td.name-cell {
                min-width: 150px;
            }
        }

        /* Small mobile devices */
        @media (max-width: 360px) {
            :root { --chemW: 160px; --stateW: 14px; }
            th.name-cell,
            td.name-cell {
                min-width: 160px;
            }
        }

        @media (max-width: 320px) {
            :root { --noW: 36px; --chemW: 140px; --stateW: 12px; }

            thead th.elastomer {
                font-size: 10px;
                padding: 4px 0;
            }
        }

        @media (hover: hover) {
            /* Cell hover effects */
            td.rating:hover {
                outline: 2px solid rgba(255, 255, 255, 0.5);
                /* remove negative offset to avoid outline overlapping neighbours */
                outline-offset: 0;
                transition: outline 0.15s ease;
            }

            tr:hover td { background-color: #f5f7fb; }
            tr:hover td.rating-5 { background-color: rgba(var(--success-rgb), 0.72); }
            tr:hover td.rating-4 { background-color: rgba(var(--primary-rgb), 0.68); }
            tr:hover td.rating-3 { background-color: rgba(var(--warning-rgb), 0.72); }
            tr:hover td.rating-2 { background-color: rgba(var(--danger-rgb), 0.72); }
            tr:hover td.rating-1 { background-color: transparent; }

            th.no-col:hover { background: var(--background); }
        }

        @media (hover: hover) and (prefers-color-scheme: dark) {
            tr:hover td { background-color: inherit; }
            tr:hover td.no-cell,
            tr:hover td.name-cell { background-color: #0b1020; }
            tr:hover td.rating { filter: brightness(1.05); }
        }

        /* Elastomer columns (match export) */
        th.elastomer, td.elastomer {
            width: var(--stateW);
            min-width: var(--stateW);
            max-width: var(--stateW);
            padding: 2px;
        }

        col.col-no { width: var(--noW); }
        col.col-chem { width: var(--chemW); }
        col.col-state { width: var(--stateW); }

        .notice {
            margin: 1rem 0;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            background: var(--card);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .notice strong {
            display: inline-block;
            margin-bottom: 0.35rem;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        footer {
            margin: 2rem 0 1.5rem;
            padding: 1rem 0;
            border-top: 1px solid var(--border);
            color: var(--text);
            font-size: 0.9rem;
            text-align: center;
        }

        .scroll-nav {
            position: fixed;
            right: 14px;
            bottom: 14px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 120;
        }

        .scroll-nav button {
            width: 40px;
            height: 40px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: color-mix(in oklab, var(--card) 85%, transparent);
            color: var(--text);
            display: grid;
            place-items: center;
            cursor: pointer;
            box-shadow: 0 10px 22px rgba(0, 0, 0, 0.16);
            backdrop-filter: blur(6px);
            transition: transform 120ms ease, opacity 160ms ease;
        }

        .scroll-nav button:hover { transform: translateY(-1px); }
        .scroll-nav button:active { transform: translateY(0); }
        .scroll-nav button:focus-visible { outline: 2px solid rgba(var(--primary-rgb), 0.55); outline-offset: 2px; }
        .scroll-nav button svg { width: 18px; height: 18px; }

        .scroll-nav button.is-hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(6px);
        }

        @media (prefers-reduced-motion: reduce) {
            html { scroll-behavior: auto; }
            .scroll-nav button { transition: none; }
        }

        /* Force-desktop behaviour (avoid mobile sticky-header logic affecting desktop) */
        @media (min-width: 641px) {
            #mobile-sticky-head { display: none !important; }
            #data-table thead { display: table-header-group !important; }
            #data-table thead th { position: sticky !important; top: var(--headH) !important; }
            .table-container { overflow: visible !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sızdırmazlık Elastomerleri Kimyasal Dayanım Tablosu</h1>
        <p class="subtitle">
            Bu sayfa; mühendislikte sızdırmazlık elemanı malzemesi olarak kullanılan 11 farklı elastomerin, ortamdaki kimyasal ile kullanılabilirliğini hızlıca kontrol etmek içindir. Uygulama koşulları farklılık gösterebileceğinden, üretici dokümanlarından teyit edilmelidir. Seçim/montaj/kullanım/bakım sorumluluğu kullanıcıdadır; hatalı seçimler ciddi yaralanma ve ekipman hasarına yol açabilir.
        </p>
    </div>

    <div class="table-toolbar" role="region" aria-label="Tablo filtreleri">
        <div class="container">
            <div class="toolbar-row">
                <label class="sr-only" for="search">Ara</label>
                <input type="search" id="search" placeholder="Kimyasal veya ID ara...">

                <label class="sr-only" for="material">Elastomer</label>
                <select id="material" aria-label="Elastomer">
                    <option value="">Elastomer</option>
                </select>

                <label class="sr-only" for="rating">Dayanım</label>
                <select id="rating" aria-label="Dayanım">
                    <option value="">Dayanım</option>
                    <option value="5">İyi</option>
                    <option value="4">Orta</option>
                    <option value="3">Zayıf</option>
                    <option value="2">Uygun Değil</option>
                    <option value="1">Veri Yok</option>
                </select>

                <div class="legend-inline" aria-label="Dayanım açıklaması">
                    <span class="legend-item"><span class="dot g"></span> İyi</span>
                    <span class="legend-item"><span class="dot f"></span> Orta</span>
                    <span class="legend-item"><span class="dot p"></span> Zayıf</span>
                    <span class="legend-item"><span class="dot b"></span> Uygun Değil</span>
                    <span class="legend-item"><span class="dot n"></span> Veri Yok</span>
                </div>

                <span id="counter" aria-live="polite">Gösterilen: - / -</span>
            </div>
        </div>
    </div>

    <main class="container table-wrap">
        <div id="mobile-sticky-head" class="mobile-sticky-head" hidden></div>
        <div class="table-container">
            <table id="data-table">
                <colgroup>
                    <col class="col-no">
                    <col class="col-chem">
                    <col class="col-state" span="11">
                </colgroup>
                <thead>
                            <tr>
                                <th scope="col" class="no-col">ID</th>
                                <th scope="col" class="name-cell">Kimyasal</th>
                                    <th scope="col" class="elastomer" title="Perfluoroelastomer">FFKM</th>
                                    <th scope="col" class="elastomer" title="Fluoroelastomer (Viton Extreme)">ETP</th>
                                    <th scope="col" class="elastomer" title="Fluoroelastomer (Viton Type A)">FKM</th>
                                    <th scope="col" class="elastomer" title="Nitrile Butadiene Rubber">NBR</th>
                                    <th scope="col" class="elastomer" title="Hydrogenated Nitrile Butadiene Rubber">HNBR</th>
                                    <th scope="col" class="elastomer" title="Ethylene Propylene Diene Monomer">EPDM</th>
                                    <th scope="col" class="elastomer" title="Tetrafluoroethylene Propylene">TFE\P</th>
                                    <th scope="col" class="elastomer" title="Silicone Rubber">VMQ</th>
                                    <th scope="col" class="elastomer" title="Fluorosilicone Rubber">FVMQ</th>
                                    <th scope="col" class="elastomer" title="Polyester Urethane">AU</th>
                                    <th scope="col" class="elastomer" title="Polytetrafluoroethylene">PTFE</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="13" class="loading">Veriler yükleniyor...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <footer>
        Mechanical Toolbox 2025 · sipahi
    </footer>

    <div class="scroll-nav" aria-label="Sayfa gezintisi">
        <button type="button" id="scrollTopBtn" class="is-hidden" aria-label="En üste git" title="En üste git">
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M12 8.3L5.3 15l1.4 1.4L12 11.1l5.3 5.3L18.7 15 12 8.3z"/>
            </svg>
        </button>
        <button type="button" id="scrollBottomBtn" aria-label="En alta git" title="En alta git">
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M12 15.7l6.7-6.7-1.4-1.4L12 12.9 6.7 7.6 5.3 9l6.7 6.7z"/>
            </svg>
        </button>
    </div>

    <script>
    const materials = ["FFKM", "ETP", "FKM", "NBR", "HNBR", "EPDM", "TFE\\P", "VMQ", "FVMQ", "AU", "PTFE"];
    const materialFullNames = {
        "FFKM": "Perfluoroelastomer",
        "ETP": "Fluoroelastomer (Viton Extreme)",
        "FKM": "Fluoroelastomer (Viton Type A)", 
        "NBR": "Nitrile Butadiene Rubber",
        "HNBR": "Hydrogenated Nitrile Butadiene Rubber",
        "EPDM": "Ethylene Propylene Diene Monomer",
        "TFE\\P": "Tetrafluoroethylene Propylene (Aflas)",
        "VMQ": "Silicone Rubber",
        "FVMQ": "Fluorosilicone Rubber",
        "AU": "Polyester Urethane",
        "PTFE": "Polytetrafluoroethylene (Teflon)"
    };
    const ratingLabels = {
        5: "İyi",
        4: "Orta",
        3: "Zayıf",
        2: "Uygun Değil",
        1: "Veri Yok"
    };
    let data = [];
    // sortState: { key: 'id'|'name'|'r0'..'r10' or null, dir: 1 (asc) or -1 (desc) }
    let sortState = { key: null, dir: 1 };

    let toolbarRO = null;
    let mobileHeaderBound = false;
    let mobileHeadScroller = null;
    let mobileScrollSyncing = false;

    function setHeadOffset() {
        const bar = document.querySelector('.table-toolbar');
        const height = bar ? bar.getBoundingClientRect().height : 0;
        document.documentElement.style.setProperty('--headH', `${Math.ceil(height)}px`);
    }

    function startToolbarObserver() {
        const bar = document.querySelector('.table-toolbar');
        if (!bar || typeof ResizeObserver === 'undefined') return;
        if (toolbarRO) toolbarRO.disconnect();
        toolbarRO = new ResizeObserver(() => setHeadOffset());
        toolbarRO.observe(bar);
    }

    function syncLayoutVars() {
        setHeadOffset();
    }

    window.addEventListener('DOMContentLoaded', () => {
        syncLayoutVars();
        startToolbarObserver();
        setupMobileStickyHeader();
        initScrollNav();
    });
    window.addEventListener('load', syncLayoutVars);
    window.addEventListener('resize', () => {
        syncLayoutVars();
        setupMobileStickyHeader();
    });

    function setupMobileStickyHeader() {
        try {
            const host = document.getElementById('mobile-sticky-head');
            const mainTable = document.getElementById('data-table');
            const scroller = document.querySelector('.table-container');
            if (!host || !mainTable || !scroller) return;

            const mql = window.matchMedia ? window.matchMedia('(max-width: 640px)') : null;
            const isMobile = !!(mql && mql.matches);

            if (!isMobile) {
                document.body.classList.remove('mobile-head-ready');
                host.hidden = true;
                host.innerHTML = '';
                host.dataset.ready = '0';
                mobileHeadScroller = null;
                return;
            }

            host.hidden = false;
            if (host.dataset.ready === '1') return;

            const colgroup = mainTable.querySelector('colgroup');
            const thead = mainTable.querySelector('thead');
            if (!colgroup || !thead) return;

            host.innerHTML = `
                <div class="head-scroller">
                    <table id="sticky-head-table" aria-hidden="false">
                        ${colgroup.outerHTML}
                        ${thead.outerHTML}
                    </table>
                </div>
            `;
            host.dataset.ready = '1';
            document.body.classList.add('mobile-head-ready');

            const headScroller = host.querySelector('.head-scroller');
            if (!headScroller) return;
            mobileHeadScroller = headScroller;

            if (!mobileHeaderBound) {
                const syncScroll = (from, to) => {
                    if (!to) return;
                    if (mobileScrollSyncing) return;
                    mobileScrollSyncing = true;
                    to.scrollLeft = from.scrollLeft;
                    (window.requestAnimationFrame || setTimeout)(() => { mobileScrollSyncing = false; }, 0);
                };

                scroller.addEventListener('scroll', () => syncScroll(scroller, mobileHeadScroller), { passive: true });
                mobileHeaderBound = true;
            }

            headScroller.addEventListener('scroll', () => {
                if (mobileScrollSyncing) return;
                mobileScrollSyncing = true;
                scroller.scrollLeft = headScroller.scrollLeft;
                (window.requestAnimationFrame || setTimeout)(() => { mobileScrollSyncing = false; }, 0);
            }, { passive: true });
            headScroller.scrollLeft = scroller.scrollLeft;

            if (mql && !mql.__pneuBound) {
                mql.addEventListener?.('change', setupMobileStickyHeader);
                mql.__pneuBound = true;
            }
        } catch (e) {
            document.body.classList.remove('mobile-head-ready');
        }
    }

    function initScrollNav() {
        const topBtn = document.getElementById('scrollTopBtn');
        const bottomBtn = document.getElementById('scrollBottomBtn');
        if (!topBtn || !bottomBtn) return;

        const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const scrollToPos = (top) => window.scrollTo({ top, behavior: prefersReduced ? 'auto' : 'smooth' });

        const update = () => {
            const doc = document.documentElement;
            const max = Math.max(0, doc.scrollHeight - window.innerHeight);
            const y = window.scrollY || doc.scrollTop || 0;
            topBtn.classList.toggle('is-hidden', y <= 24);
            bottomBtn.classList.toggle('is-hidden', (max - y) <= 24);
        };

        topBtn.addEventListener('click', () => scrollToPos(0));
        bottomBtn.addEventListener('click', () => scrollToPos(document.documentElement.scrollHeight));

        window.addEventListener('scroll', update, { passive: true });
        window.addEventListener('resize', update);
        update();
    }

        // Initialize material select
        const materialSelect = document.getElementById("material");

        function restoreMaterialOptionTexts() {
            if (!materialSelect) return;
            for (const opt of Array.from(materialSelect.options)) {
                if (opt.dataset.long) opt.textContent = opt.dataset.long;
            }
        }

        function expandMaterialSelect() {
            if (!materialSelect) return;
            if (window.matchMedia && window.matchMedia("(max-width: 640px)").matches) return;
            materialSelect.style.minWidth = "260px";
            materialSelect.style.width = "260px";
        }

        function compactMaterialSelectedText() {
            if (!materialSelect) return;
            const opt = materialSelect.selectedOptions && materialSelect.selectedOptions[0];
            if (opt && opt.value && opt.dataset.short) opt.textContent = opt.dataset.short;
        }

        function compactMaterialSelect() {
            if (!materialSelect) return;
            materialSelect.style.minWidth = "";
            materialSelect.style.width = "";
        }

        if (materialSelect) {
            materials.forEach(mat => {
                const option = document.createElement("option");
                option.value = mat;
                option.dataset.short = mat;
                option.dataset.long = `${mat} - ${materialFullNames[mat]}`;
                option.textContent = option.dataset.long;
                materialSelect.appendChild(option);
            });

            restoreMaterialOptionTexts();
            compactMaterialSelectedText();

            materialSelect.addEventListener("mousedown", () => { restoreMaterialOptionTexts(); expandMaterialSelect(); });
            materialSelect.addEventListener("touchstart", () => { restoreMaterialOptionTexts(); expandMaterialSelect(); });
            materialSelect.addEventListener("keydown", (e) => {
                if (e.key === "Enter" || e.key === " " || e.key === "ArrowDown") {
                    restoreMaterialOptionTexts();
                    expandMaterialSelect();
                }
                if (e.key === "Escape") {
                    setTimeout(() => { compactMaterialSelectedText(); compactMaterialSelect(); }, 0);
                }
            });
            materialSelect.addEventListener("blur", () => { compactMaterialSelectedText(); compactMaterialSelect(); });
            materialSelect.addEventListener("change", () => { compactMaterialSelectedText(); compactMaterialSelect(); });
        }

    // Load and parse CSV data
        async function loadData() {
            try {
                const response = await fetch("assets/data/chemresist.txt");
                const text = await response.text();
                
                data = text.split(/\r?\n/)
                    .filter(line => line && !line.startsWith("#"))
                    .map(line => {
                        const [name, ratings] = line.split("|").map(s => s.trim());
                        if (!name || !ratings) return null;
                        if (ratings.length !== 11) return null; // Must be exactly 11 digits
                        return {
                            name: name,
                            ratings: ratings.split("").map(r => {
                                const n = parseInt(r, 10);
                                return (n >= 1 && n <= 5) ? n : 1;
                            })
                        };
                    })
                    .filter(Boolean) // Remove nulls
                    .map((item, idx) => ({ ...item, id: idx + 1 })); // stable ID from source order
                
                renderTable();
                updateCounter();
                attachSortHandlersFor('#data-table');
                attachSortHandlersFor('#sticky-head-table');
            } catch (error) {
                console.error("Veri yüklenirken hata:", error);
                document.querySelector("tbody").innerHTML = 
                    '<tr><td colspan="13" class="loading">Veri yüklenemedi!</td></tr>';
            }
        }

        function updateCounter(filteredCount) {
            const cnt = document.getElementById('counter');
            const total = data.length || 0;
            const shown = (typeof filteredCount === 'number') ? filteredCount : total;
            if (cnt) cnt.textContent = `Gösterilen: ${shown} / ${total}`;
        }

        // Render table with filtered data
        function renderTable() {
            const searchTerm = document.getElementById("search").value.toLowerCase().trim();
            const selectedMaterial = document.getElementById("material").value;
            const selectedRating = document.getElementById("rating").value;

            const filtered = data.filter(item => {
                // Text search filter
                if (searchTerm) {
                    const idMatch = String(item.id || "").includes(searchTerm);
                    const nameMatch = item.name.toLowerCase().includes(searchTerm);
                    if (!idMatch && !nameMatch) return false;
                }
                
                // Rating filter
                const ratingNum = Number(selectedRating);
                if (selectedRating) {
                    if (selectedMaterial) {
                        // If material is selected, check only that material's rating
                        const index = materials.indexOf(selectedMaterial);
                        if (item.ratings[index] !== ratingNum) return false;
                    } else {
                        // If only rating is selected (no material), check all materials must match
                        if (!item.ratings.every(r => r === ratingNum)) return false;
                    }
                } else if (selectedMaterial) {
                    // If only material is selected (no rating), include all its ratings
                    const index = materials.indexOf(selectedMaterial);
                    if (item.ratings[index] < 1) return false;
                }
                
                return true;
            });

            // Apply sorting if requested
            if (sortState.key !== null) {
                const d = sortState.dir;
                filtered.sort((a, b) => {
                    if (sortState.key === 'id') {
                        return (a.id - b.id) * d;
                    }
                    if (sortState.key === 'name') {
                        const cmp = a.name.localeCompare(b.name);
                        return cmp !== 0 ? cmp * d : (a.id - b.id);
                    }
                    if (sortState.key.startsWith('r')) {
                        const c = parseInt(sortState.key.slice(1), 10);
                        const va = a.ratings[c] || 0;
                        const vb = b.ratings[c] || 0;
                        if (va === vb) return a.name.localeCompare(b.name);
                        return (va - vb) * d;
                    }
                    return 0;
                });
            }

            const tbody = document.querySelector("tbody");
            tbody.innerHTML = filtered.map((item, idx) => `
                <tr>
                    <td class="no-cell">${item.id}</td>
                    <td class="name-cell" title="${item.name}">${item.name}</td>
                            ${item.ratings.map(rating => `
                                <td class="rating elastomer rating-${rating}" title="${ratingLabels[rating]}"></td>
                            `).join("")}
                </tr>
            `).join("");

            updateCounter(filtered.length);
            attachSortHandlersFor('#sticky-head-table');
            updateSortIndicators();
        }

        // Event listeners
        document.getElementById("search").addEventListener("input", renderTable);
        document.getElementById("material").addEventListener("change", renderTable);
        document.getElementById("rating").addEventListener("change", renderTable);

        function attachSortHandlersFor(tableSel) {
            const root = document.querySelector(tableSel);
            if (!root) return;
            const ths = Array.from(root.querySelectorAll('thead th'));
            ths.forEach((th, i) => {
                if (th.dataset.sortBound === '1') return;
                let key = null;
                if (th.classList.contains('no-col')) key = 'id';
                else if (th.classList.contains('name-cell')) key = 'name';
                else if (i >= 2) key = `r${i - 2}`; // elastomer columns

                if (!key) return;
                th.style.cursor = 'pointer';
                th.tabIndex = 0;
                th.setAttribute('role', 'button');
                th.setAttribute('aria-sort', 'none');
                th.dataset.sortBound = '1';
                th.addEventListener('click', () => {
                    if (sortState.key === key) {
                        sortState.dir = -sortState.dir; // toggle
                    } else {
                        sortState.key = key;
                        sortState.dir = -1; // default desc
                    }
                    renderTable();
                });
                th.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        th.click();
                    }
                });
            });
        }

        function updateSortIndicators() {
            const apply = (rootSel) => {
                const root = document.querySelector(rootSel);
                if (!root) return;
                const ths = Array.from(root.querySelectorAll('thead th'));
                ths.forEach((th, i) => {
                let key = null;
                if (th.classList.contains('no-col')) key = 'id';
                else if (th.classList.contains('name-cell')) key = 'name';
                else if (i >= 2) key = `r${i - 2}`;

                const base = th.dataset.label || th.textContent.replace(/\s*[▲▼]$/,'');
                th.dataset.label = base;
                if (sortState.key === key) {
                    th.textContent = base + (sortState.dir === -1 ? ' ▼' : ' ▲');
                    th.setAttribute('aria-sort', sortState.dir === -1 ? 'descending' : 'ascending');
                } else {
                    th.textContent = base;
                    th.setAttribute('aria-sort', 'none');
                }
                });
            };
            apply('#data-table');
            apply('#sticky-head-table');
        }

        // Initial load
        loadData();
    </script>
</body>
</html>
